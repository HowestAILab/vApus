[UninstallRun]
Filename: {app}\vApus.KillvApusAndTools.exe

[Code]
function IsDotNetDetected(): boolean;
var
    key, version: string;
    install: cardinal;
    success: boolean;
begin
    key := 'SOFTWARE\Microsoft\NET Framework Setup\NDP\v4\Full';
    success := RegQueryDWordValue(HKLM, key, 'Install', install);
    success := success and RegQueryStringValue(HKLM, key, 'Version', version);

    result := success and (install = 1) and (pos('4.5.51650', version) = 1);
end;

procedure DeinitializeSetup();
var
  ResultCode: integer;
begin
    	if IsDotNetDetected() then begin
		Exec(ExpandConstant('{app}\vApus.JumpStart.exe'), '', '', SW_SHOW, ewNoWait, ResultCode);
	end
    	else begin
		if Exec(ExpandConstant('{app}\NDP452-KB2901954-Web.exe'), '', '', SW_SHOW,
			ewWaitUntilTerminated, ResultCode) then begin
			Exec(ExpandConstant('{app}\vApus.JumpStart.exe'), '', '', SW_SHOW, ewNoWait, ResultCode);
		end;
	end;
end;